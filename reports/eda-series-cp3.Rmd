---
title: "Minhas perguntas"
author: "Valter Lucena"
date: "3 de maio de 2018"
output:
  html_document:
    df_print: paged
    toc: yes
    toc_float: yes
  html_notebook:
    toc: yes
    toc_float: yes
---

```{r setup, echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(here)
theme_set(theme_bw())
```

Esta análise será realizada utilizando dados sobre avaliações de espisódios de séries presentes no [IMDB](https://www.imdb.com). Mais informações sobre esses dados podem ser encontradas [neste](https://github.com/nazareno/imdb-series) repositório do professor Nazareno Andrade.

# Escolha das séries e entendimento dos dados

Primeiramente, vamos importar os dados e selecionar as séries que serão analisadas.

```{r}
episodios = read_csv(here("data/series_from_imdb.csv"), 
                    progress = FALSE,
                    col_types = cols(.default = col_double(), 
                                     series_name = col_character(), 
                                     episode = col_character(), 
                                     url = col_character(),
                                     season = col_character()))
```

Resolvi analisar séries que possuem a mesma quantidade de temporadas e uma quantidade semelhante de episódios por temporada que *Game of Thrones*. Até a época onde esses dados foram coletados, existiam apenas informações sobre os episódios das suas 6 primeiras temporadas. Sabendo que cada temporada de *Game of Thrones* possui 10 episódios, vamos selecionar séries que possuem um número parecido de episódios por temporada. 

```{r}
episodios %>%
    mutate(Série = series_name) %>% 
    group_by(Série) %>% 
    summarise(Temporadas = max(season), 
              `Episódios por temporada` = max(season_ep)) %>% 
    filter(Temporadas == 6, 
           (`Episódios por temporada` >= 10), 
           (`Episódios por temporada` <= 13))
```

Analisaremos, então, *American Horror Story*, *Game of Thrones* e *Homeland*.

```{r}
series_escolhidas = episodios %>% 
    filter(series_name %in% c("American Horror Story", 
                              "Game of Thrones", 
                              "Homeland"))
```

## Existe alguma relação entre o número de avaliações e avaliação geral das séries?

```{r}
series_escolhidas %>% 
    mutate(Séries = series_name) %>% 
    ggplot(aes(x = user_rating,
               y = user_votes,
               color = Séries)) +
    geom_jitter(alpha = .5,
                size = 3) +
    scale_y_continuous(breaks = seq(0, 150000, 10000)) +
    facet_wrap(~ series_name)
```

Graficamente, podemos observar que *American Horror Story* e *Homeland* se comportam de forma parecida, com as avaliações mais concentradas entre 8 e 9 com menos de 10000 votantes. Já em *Game of Thrones*, percebe-se que todas as avaliações possuem notas maiores ou iguais a 8, e que esse valor aumenta com a quantidade de votos. Podemos usar, aqui, uma medida chamada **correlação** para verificar se duas variáveis se associam linearmente. Essa medida é um valor entre -1 e 1 e é classificada da seguinte forma:

* A associação é dita fraca se o módulo de seu valor aproxima-se de 0, e forte quando aproxima-se de 1.
* Se o valor da correlação é negativo, os valores de uma variável diminuem quando os da outra aumentam, e, se for positivo, aumentam quando os valores da outra variável também aumentam.

Utilizaremos a **correlação de Pearson** para isso, pois a mesma calcula a correlação entre duas variáveis contínuas.

```{r}

series_escolhidas %>% 
    group_by(series_name) %>% 
    mutate(Séries = series_name,
           correlacao = cor(user_rating, 
                            user_votes,
                            method = "pearson")) %>% 
    ungroup() %>% 
    select(Séries, correlacao) %>% 
    unique() %>% 
    ggplot(aes(x = reorder(Séries, correlacao),
               y = correlacao,
               fill = Séries,
               label = round(correlacao, 2))) +
    geom_col() +
    geom_text(position = position_stack(vjust = 0.5)) +
    labs(x = "Séries",
         y = "Correlação (Pearson)")
```

Com esses valores, obtemos as seguintes informações:

* Em nenhuma série a quantidade de votos influencia negativamente na sua avaliação.
* Para *Homeland* e *American Horror Story* a associação é fraca, sendo mais significativa em *American Horror Story* e bastante fraca em *Homeland*.
* Em *Game of Thrones*, a associação é moderadamente significativa, ainda que não seja tão forte.

Assim, podemos concluir que, para as séries analisadas, quanto maior a quantidade de votos, maior é avaliação da série. Esse aumento é mais forte em *American Horror Story* e *Game of Thrones* do que em *Homeland*, mas não é tão significativo. 

É importante ressaltar, que, como a correlação calcula a associação linear entre as variáveis, a observação cuja quantidade de votos é menor que 10000 com uma avaliação um pouco maior que 5 faz com que a nuvem de pontos da série *Homeland* aproxime-se de uma reta horizontal, sendo esta, talvez, a possível causa para a correlação possuir um valor tão baixo. Para *Game of Thrones*, a grande quantidade de votos com avaliação maior que 9 pode ser a razão da série possuir o maior valor de correlação entre as séries analisadas.

## A temporada mais bem avaliada da série possui uma maior proporção de notas 10?

Vejamos, primeiramente, qual a temporada mais bem avaliada de cada série. A temporada mais bem avaliada aqui será a que possuir a maior nota entre as temporadas.

```{r}
series_escolhidas %>% 
    group_by(series_name, season) %>% 
    summarise(Avaliação = max(user_rating)) %>% 
    ungroup() %>% 
    select(series_name, season, Avaliação) %>% 
    mutate(Séries = series_name, Temporada = season) %>% 
    ggplot(aes(x = Temporada,
               y = Avaliação,
               color = Séries)) +
    geom_point(size = 3) +
    geom_segment(aes(x = Temporada,
                     xend = Temporada,
                     y = 0,
                     yend = Avaliação)) +
    facet_wrap(~Séries)
```

Com o gráfico, observamos que as temporadas mais bem avaliadas de *American Horror Story*, *Game of Thrones* e *Homeland* são, respectivamente, a 2ª, 6ª e 4ª temporadas.

Observemos agora, como se comporta a proporção de notas 10 por temporada.

```{r}
series_escolhidas %>% 
    mutate(Séries = series_name) %>% 
    ggplot(aes(x = season,
               y = r10 * 100,
               fill = Séries)) +
    geom_col(position = "identity") +
    facet_wrap(~ series_name) +
    labs(x = "Temporada",
         y = "Proporção de notas 10 (%)") +
    theme(legend.position = "bottom")
```

Se procurarmos neste gráfico, as temporadas mais bem avaliadas que encontramos no gráfico anterior, iremos perceber que essas temporadas são as que possuem a maior proporção de notas 10 (*Game of Thrones* e *Homeland*), ou se encontram entre as que possuem a maior proporção (*American Horror Story*).

Logo, é possível concluir, para as séries escolhidas, que a temporada mais bem avaliada de cada série possui uma maior proporção de avaliações com notas 10.